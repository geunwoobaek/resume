# 넥슨 코리아 - 인텔리전스 랩스

> 백엔드 엔지니어 | 2022.01 ~ 2022.10

넥슨코리아 인텔리전스 랩스에서 백엔드 엔지니어로 근무하며, 카트라이더, 바람의 나라, 서든어택 등 다수의 게임 서비스를 대상으로 실시간 이벤트 시스템 개발 및 다용도 백엔드 API 서버 운영을 담당했습니다.

---

## 기술 스택

| 구분 | 기술 |
|------|------|
| **Language** | Scala, C# |
| **Framework** | Apache Flink |
| **Message Queue** | Apache Kafka |
| **Database** | AuroraDB, MSSQL |
| **기타** | Realtime Streaming ETL |

---

## 프로젝트 상세

### 1. 실시간 이벤트 개발

카트라이더, 카트러쉬+, 바람의 나라, 서든어택 등 게임 서비스에서 유저에게 제공하는 보상 이벤트 시스템을 개발했습니다.

기술 스택 : Scala, Flink, Kafka, AuroraDB

#### Realtime Streaming ETL 구축

- **Kafka**로 컨슈밍한 게임 로그에 대해 **Flink Framework**로 Realtime streaming ETL 파이프라인 구축
- 게임 내 유저 행동 데이터(로그인, 플레이, 미션 달성 등)를 실시간으로 수집 및 가공
- 대규모 게임 로그를 안정적으로 처리하기 위한 스트리밍 아키텍처 설계

#### 이벤트 데이터 API 서빙

- 가공된 이벤트 데이터를 게임 서비스 팀에 API로 제공
- 유저별 이벤트 달성 현황, 보상 지급 상태 등의 데이터 서빙
- 이벤트 기간 동안의 트래픽 증가에 대응하는 안정적인 API 서빙

#### 이벤트 모듈 개선

- 기존 이벤트 모듈의 로직 수정 및 기능 보완
- 새로운 이벤트 유형에 대한 확장 가능한 구조로 개선
- 이벤트 조건 판정 로직 정확도 향상

---

### 2. 다용도 백엔드 API 서버 운영

게임별 유저 정보, 캐시 정보, 배너 등 각 게임 서비스 팀에서 필요한 다용도 백엔드 API 서버를 운영 및 관리했습니다.

기술스택 : C#, MSSQL, RDB

#### DB 성능 개선

- DB에서 발생하는 **지연시간(Latency) 이슈 진단 및 해결**
- 쿼리 실행 계획 분석 및 인덱스 최적화
- MSSQL 환경에서의 성능 튜닝 경험

#### 서비스 유지보수

- 각 게임 서비스별 API 문제 해결 및 전반적인 유지보수 담당
- 여러 게임 팀의 다양한 요구사항에 대한 API 개발 및 수정
- 서비스 안정성 모니터링 및 장애 대응

---

## 아키텍처

### 실시간 이벤트 Streaming ETL 파이프라인

```mermaid
sequenceDiagram
    participant KR as 카트라이더
    participant KR2 as 카트러쉬+
    participant WN as 바람의 나라
    participant SA as 서든어택
    participant Kafka as Apache Kafka<br/>(Topic per Game)
    participant Consumer as Kafka Consumer<br/>(Scala)
    participant Flink as Flink Job<br/>(Streaming ETL)
    participant Window as Flink Window<br/>(Time/Count)
    participant State as Flink State<br/>(Keyed State)
    participant DB as AuroraDB
    participant API as 이벤트 API 서버
    actor Team as 게임 서비스 팀
    actor User as 게임 유저

    rect rgb(240, 248, 255)
        Note over KR,Kafka: 1. Source - 게임별 Kafka Topic으로 로그 발행
        KR->>Kafka: 유저 행동 로그 (로그인, 플레이, 미션 달성, 아이템 획득)
        KR2->>Kafka: 유저 행동 로그
        WN->>Kafka: 유저 행동 로그
        SA->>Kafka: 유저 행동 로그
    end

    rect rgb(255, 248, 240)
        Note over Consumer,State: 2. Streaming ETL - Flink 실시간 처리
        Kafka->>Consumer: 게임별 Topic 실시간 컨슈밍
        Consumer->>Flink: Deserialization + Source Function

        Flink->>Flink: Filter - 이벤트 대상 로그만 필터링<br/>(게임 ID, 로그 타입, 유효성 검증)
        Flink->>Flink: Map / FlatMap - 로그 데이터 정규화<br/>(게임별 상이한 스키마 → 통합 이벤트 포맷)
        Flink->>Flink: KeyBy - 유저 ID 기준 파티셔닝

        Flink->>Window: Window 집계<br/>(Tumbling/Sliding Window)
        Window->>State: 유저별 이벤트 진행 상태 조회
        State-->>Window: 누적 카운트 / 달성 현황
        Window->>Window: 이벤트 조건 판정<br/>(미션 N회 달성, 연속 로그인, 특정 아이템 수집 등)

        alt 이벤트 조건 충족
            Window->>State: 유저 이벤트 상태 업데이트 (달성 완료)
            Window->>DB: Sink - 이벤트 달성 결과 적재<br/>(유저 ID, 이벤트 ID, 달성 시각, 보상 정보)
        else 조건 미충족 (진행 중)
            Window->>State: 누적 진행도 업데이트
        end
    end

    rect rgb(240, 255, 240)
        Note over API,User: 3. Serving - 이벤트 데이터 API 서빙
        User->>Team: 게임 내 이벤트 페이지 접근
        Team->>API: 유저 이벤트 달성 현황 조회 (userId, eventId)
        API->>DB: 이벤트 달성 데이터 조회
        DB-->>API: 달성 현황 (진행도, 보상 수령 가능 여부)
        API-->>Team: API 응답

        Team->>API: 보상 지급 요청
        API->>DB: 보상 지급 상태 업데이트
        DB-->>API: 지급 완료
        API-->>Team: 보상 지급 결과
        Team-->>User: 인게임 보상 지급
    end

    rect rgb(255, 240, 255)
        Note over Team,API: 4. 이벤트 모듈 관리
        Team->>API: 신규 이벤트 등록 (조건, 기간, 보상 설정)
        API->>DB: 이벤트 설정 저장
        API->>Flink: 이벤트 조건 룰 반영
        Note over Flink,State: 이벤트 유형 확장<br/>(누적형, 연속형, 수집형, 조건 조합형 등)
    end
```

### 다용도 백엔드 API 서버 흐름

```mermaid
sequenceDiagram
    actor Team1 as 카트라이더 팀
    actor Team2 as 바람의 나라 팀
    actor Team3 as 서든어택 팀
    participant API as 다용도 API 서버 (C#)
    participant DB as MSSQL

    Team1->>API: 유저 정보 조회 요청
    API->>DB: 쿼리 실행
    DB-->>API: 유저 데이터
    API-->>Team1: JSON 응답

    Team2->>API: 캐시 정보 요청
    API->>DB: 쿼리 실행
    DB-->>API: 캐시 데이터
    API-->>Team2: JSON 응답

    Team3->>API: 배너 데이터 요청
    API->>DB: 쿼리 실행
    DB-->>API: 배너 데이터
    API-->>Team3: JSON 응답

    Note over API,DB: DB 지연시간 이슈 진단 및 해결<br/>쿼리 실행 계획 분석 + 인덱스 최적화
```
